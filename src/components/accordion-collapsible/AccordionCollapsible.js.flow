// @flow
import * as React from 'react';
import classNames from 'classnames';
import AnimateHeight from 'react-animate-height';

import { bdlGray50 } from '../../styles/variables';
import IconChevron from '../../icons/general/IconChevron';
import PlainButton from '../plain-button';

import './AccordionCollapsible.scss';

type Props = {
    /** animationDuration - duration of animation in milliseconds */
    animationDuration?: number,
    /** buttonProps - other props (e.g. resin target names) to be included in the button */
    buttonProps?: Object,
    /** children - content to be displayed in the card when it is expanded */
    children: React.Node,
    /** className - CSS class for the wrapper div */
    className?: string,
    /** containerProps - other props (e.g. resin target names) to be included in wrapper div */
    containerProps?: Object,
    /** isOpen - initial state of the collapsible card */
    isOpen: boolean,
    /** onClose - callback called when collapsible is opened */
    onClose?: Function,
    /** onOpen - callback called when collapsible is collapsed */
    onOpen?: Function,
    /** title - string or component in the title of the collapsible card */
    title: string | React.Node,
};

const AccordionCollapsible = ({
    animationDuration = 100,
    containerProps,
    buttonProps,
    children,
    className,
    isOpen,
    onClose,
    onOpen,
    title,
}: Props) => {
    const [state, setState] = React.useState({ isOpen });

    const toggleVisibility = () => {
        if (state.isOpen && onClose) {
            onClose();
        } else if (!state.isOpen && onOpen) {
            onOpen();
        }
        setState({ isOpen: !state.isOpen });
    };

    return (
        <div
            {...containerProps}
            className={classNames('accordion-collapsible-container', className, {
                'is-open': state.isOpen,
            })}
        >
            <div className="accordion-collapsible-header">
                <PlainButton
                    {...buttonProps}
                    aria-expanded={state.isOpen}
                    className="accordion-collapsible-header-btn"
                    onClick={toggleVisibility}
                    type="button"
                >
                    <div className="accordion-collapsible-title">{title}</div>
                    <IconChevron
                        className="accordion-collapsible-icon"
                        color={bdlGray50}
                        direction={state.isOpen ? 'down' : 'right'}
                    />
                </PlainButton>
            </div>
            <AnimateHeight duration={animationDuration} height={state.isOpen ? 'auto' : 0}>
                <div className="accordion-collapsible-dropdown-container">{children}</div>
            </AnimateHeight>
        </div>
    );
};

export default AccordionCollapsible;
